version: 1
metadata:
  name: Scribe - Redirect Policy
context:
  scribe_hub_redirect_uri: !Env [AUTHENTIK_SCRIBE_HUB_REDIRECT_AFTER_LOGIN_URI, null]
entries:
# policies
- attrs:
    execution_logging: true
    expression: !Format ["plan = request.context.get(\"flow_plan\")\nif not plan:\n    return False\nplan.redirect(\"%s\")\nreturn False", !Context scribe_hub_redirect_uri]
    name: scribe-hub-redirect
  conditions: 
    - !If [!Context scribe_hub_redirect_uri]
  identifiers:
    name: scribe-hub-redirect
  model: authentik_policies_expression.expressionpolicy
  state: present